# SM2 签名验证系统 - 开发文档

基于国密 SM2 算法的数字签名系统的源代码说明文档。本系统同时提供 GUI 客户端和 Web 界面，支持完整的密钥管理、文件签名和验证功能。

## 核心功能实现

### SM2 算法实现 (sm2_core.py)
- 完整实现 SM2 椭圆曲线数字签名算法
- 支持密钥对生成、签名和验证
- 实现了 ZA 值计算和 SM3 哈希
- 包含完整的椭圆曲线点运算

### GUI 界面 (sm2_gui.py)
- 基于 tkinter 实现的图形界面
- 支持文件拖放操作
- 实时显示操作状态和结果
- 支持密钥导入导出

### Web 接口 (web/api.py)
- RESTful API 设计
- 支持跨域请求 (CORS)
- JSON 格式数据交互
- 异步处理文件操作

## 项目依赖

```python
gmssl>=3.2.1
pathlib>=1.0.1
flask>=2.0.0
flask-cors>=3.0.10
python-dotenv>=0.19.0
```

## 目录结构

```
src/
├── launcher.py      # 启动入口，处理命令行参数
├── main.py         # 主程序逻辑
├── sm2_core.py     # SM2 算法核心实现
├── sm2_gui.py      # GUI 界面实现
├── test_*.py       # 单元测试文件
├── assets/         # 资源文件目录
│   └── keys/       # 密钥存储目录
├── data/           # 数据存储
│   ├── input/      # 待签名文件
│   └── signed/     # 签名后的文件
└── web/           # Web 相关文件
    ├── api.py     # Web API 实现
    ├── index.html # Web 前端页面
    ├── css/       # 样式文件
    └── js/        # JavaScript 脚本

## 开发指南

### 密钥管理模块
- 私钥使用随机数生成
- 支持从文件加载密钥
- 密钥格式采用 16 进制字符串
- 提供密钥导入导出功能

### 签名实现说明
1. 计算 ZA 值：
   - 包含用户 ID
   - 椭圆曲线参数
   - 公钥信息
2. 生成签名：
   - 随机数 k 的生成和验证
   - 计算签名值 (r,s)
   - 生成签名文件

### 验证实现说明
1. 验证签名规范性：
   - 检查 r,s 范围
   - 验证 t 值有效性
2. 计算验证点：
   - [s]G + [t]PA
   - 验证等式成立

### 单元测试
- test_verify.py: 签名验证测试
- test_point_compare.py: 椭圆曲线运算测试

## 异常处理

系统实现了完整的异常处理机制：
- 文件操作异常
- 密钥格式异常
- 签名验证异常
- 网络通信异常

## 日志系统

- 使用 Python 标准日志模块
- 分别记录 GUI 和 Web 日志
- 支持不同级别的日志
- 按日期生成日志文件

## 安全建议

1. 密钥管理：
   - 定期更换密钥对
   - 安全备份私钥
   - 避免明文传输

2. 签名操作：
   - 验证文件完整性
   - 检查签名时间戳
   - 确认公钥来源

3. 系统配置：
   - 限制 API 访问
   - 配置 HTTPS
   - 设置访问权限

## 开发环境

- Python 3.8+
- VS Code 或 PyCharm
- 建议使用虚拟环境

## 参与开发

1. 代码规范：
   - 遵循 PEP 8
   - 添加详细注释
   - 编写单元测试

2. 提交流程：
   - 创建功能分支
   - 编写提交信息
   - 提交 PR

## 调试指南

1. GUI 调试：
   - 使用 `--debug` 参数
   - 查看日志输出
   - 断点调试支持

2. Web 调试：
   - Flask Debug 模式
   - 浏览器开发工具
   - API 接口测试

## 版本控制

- 使用 Git 进行版本控制
- 遵循语义化版本规范
- 保持提交信息清晰

## 已知问题

1. GUI 相关：
   - 大文件处理优化
   - 界面响应优化

2. Web 相关：
   - 会话管理完善
   - 并发处理优化

## 后续计划

1. 功能增强：
   - 支持更多文件类型
   - 批量处理功能
   - 证书管理集成

2. 性能优化：
   - 算法性能优化
   - 缓存机制引入
   - 异步处理改进

## 技术支持

- 查看详细文档
- 提交 Issue
- 贡献代码

## 许可证

MIT License - 详见根目录的 LICENSE 文件